import{a as R}from"./allProducts-c26f0f70.js";import{_ as x,k as S,B as V,g as N,l as E,m as A,o,a as d,d as c,e as l,w as B,p as C,t as y,r as i,q as U,F as b,b as k,f as w,c as F}from"./app-aa966424.js";import{s as n}from"./SearchKeywordsEnum-1c50111d.js";import{b as I}from"./products-99d1b3bb.js";import{P as O}from"./ProductCategoriesSelect-9a7eb4b7.js";import{P as q}from"./ProductCard-deb62e2e.js";import"./categories-85f10fb0.js";import"./ProductPrice-d0fb473b.js";import"./price-38bf80ae.js";import"./ProductOpenLink-f21a3374.js";import"./StyledRouterLink-4f78989f.js";import"./ItemImage-884cebd2.js";const L={name:"FiltersBlock",components:{ProductCategoriesSelect:O,FullWidthButton:S,BasedText:V},emits:["updateFilters"],computed:{minPrice:{get(){return this.priceBetween[0]},set(e){this.priceBetween[+(e>=this.maxPrice)]=+e}},maxPrice:{get(){return this.priceBetween[1]},set(e){this.priceBetween[1]=+e}}},data(){return{hasReviews:!1,priceBetween:[],categoriesOptions:[],selectedCategories:[],sellers:[],sellersOptions:[],selectedSellers:[],sellersPending:!0,maxAvailablePrice:1e6}},props:{productsLoadingPending:{required:!0,type:Boolean}},methods:{async loadSellers(){try{this.sellers=(await N(I)).data,this.sellersOptions=this.sellers.map(e=>({value:e.id,label:e.name})),this.sellersPending=!1}catch(e){E(A(e)),console.error(e)}},saveFilters(){const e={[n.hasReviews]:this.hasReviews||null,[n.sellers]:this.selectedSellers.join(",")||null,[n.categories]:this.selectedCategories.join(",")||null,[n.priceBetween]:this.getValidatedPriceBetween()};this.$emit("updateFilters",e)},getValidatedPriceBetween(){const[e,t]=[this.minPrice,this.maxPrice].sort((u,m)=>u-m);return e===0&&t===this.maxAvailablePrice?null:t===this.maxAvailablePrice?[e,Number.MAX_SAFE_INTEGER]:[e,t]},getSelectedIdsFromString(e){return(e||"").split(",").map(t=>parseInt(t)).filter(t=>t&&!isNaN(t))}},mounted(){this.priceBetween=[0,this.maxAvailablePrice],this.loadSellers();const e=this.$route.query,t=e[n.priceBetween];this.hasReviews=!!e[n.hasReviews],this.selectedSellers=this.getSelectedIdsFromString(e[n.sellers]),this.selectedCategories=this.getSelectedIdsFromString(e[n.categories]),this.priceBetween=(t||[0,this.maxAvailablePrice]).map(Number)}},T={class:"filter-block"},j={class:"filter-block"},D={class:"slider-inputs"},G={class:"filter-block"},M={class:"filter-block"};function $(e,t,u,m,s,a){const h=i("based-text"),P=i("el-checkbox"),_=i("el-input"),f=i("el-slider"),v=i("el-select-v2"),g=i("product-categories-select"),p=i("full-width-button");return o(),d("div",null,[c("div",T,[l(P,{modelValue:s.hasReviews,"onUpdate:modelValue":t[0]||(t[0]=r=>s.hasReviews=r)},{default:B(()=>[l(h,{title:e.$t("search.filters.hasReviews")},null,8,["title"])]),_:1},8,["modelValue"])]),c("div",j,[l(h,{title:e.$t("search.filters.priceBetween")},null,8,["title"]),c("div",D,[l(_,{modelValue:a.minPrice,"onUpdate:modelValue":t[1]||(t[1]=r=>a.minPrice=r)},null,8,["modelValue"]),l(_,{modelValue:a.maxPrice,"onUpdate:modelValue":t[2]||(t[2]=r=>a.maxPrice=r)},null,8,["modelValue"])]),l(f,{modelValue:s.priceBetween,"onUpdate:modelValue":t[3]||(t[3]=r=>s.priceBetween=r),range:"",max:s.maxAvailablePrice},null,8,["modelValue","max"])]),c("div",G,[l(h,{title:e.$t("search.filters.sellers")+":"},null,8,["title"]),l(v,{class:"filter-select",modelValue:s.selectedSellers,"onUpdate:modelValue":t[4]||(t[4]=r=>s.selectedSellers=r),disabled:s.sellersPending,filterable:"",options:s.sellersOptions,placeholder:e.$t("search.filters.sellers"),multiple:""},null,8,["modelValue","disabled","options","placeholder"])]),c("div",M,[l(h,{title:e.$t("search.filters.categories")+":"},null,8,["title"]),l(g,{"selected-categories":s.selectedCategories,"onUpdate:selectedCategories":t[5]||(t[5]=r=>s.selectedCategories=r)},null,8,["selected-categories"])]),l(p,{pending:u.productsLoadingPending,onClick:t[6]||(t[6]=r=>a.saveFilters())},{default:B(()=>[C(y(e.$t("search.filters.apply")),1)]),_:1},8,["pending"])])}const K=x(L,[["render",$],["__scopeId","data-v-3c5eea61"]]);const W={name:"Search",components:{ProductCard:q,FullWidthButton:S,FiltersBlock:K,BasedText:V},mixins:[R,U],data(){return{products:[],productsPending:!1,searchBy:""}},methods:{reloadProducts(){this.products=[],this.productsPagination=[],this.loadProducts()},loadProducts(){const e=this.$route.query;this.searchBy=e[n.searchBy],this.usePending(this.pushProductsToArray,"productsPending",this.productsPagination.next_cursor,e)},updateFilters(e){const t={[n.searchBy]:this.searchBy,...e};this.$router.push({name:"Search",query:this.deleteNullableFilters(t)})},deleteNullableFilters(e){const t={};return Object.keys(e).forEach(u=>{const m=e[u];m&&(t[u]=m)}),Object.assign(t)}},mounted(){this.reloadProducts()},watch:{$route(){this.reloadProducts()}}},X={class:"search-by-title-container"},z={class:"search-container"},H={class:"search-filters-container"},J={class:"search-filters-block card"},Q={key:0},Y={key:0},Z={key:1,class:"empty-products-error card"},ee={key:1};function te(e,t,u,m,s,a){var g;const h=i("based-text"),P=i("filters-block"),_=i("product-card"),f=i("el-skeleton"),v=i("full-width-button");return o(),d(b,null,[c("div",X,[l(h,{class:"search-by-title",title:s.searchBy},null,8,["title"])]),c("div",z,[c("div",H,[c("div",J,[l(P,{"products-loading-pending":s.productsPending,onUpdateFilters:a.updateFilters},null,8,["products-loading-pending","onUpdateFilters"])])]),c("div",null,[!s.productsPending||s.products.length>0?(o(),d("div",Q,[s.products.length>0?(o(),d("div",Y,[(o(!0),d(b,null,k(s.products,p=>(o(),F(_,{product:p,key:p.slug,"is-show-add-to-cart-button":!0},null,8,["product"]))),128))])):w("",!0),!s.productsPending&&s.products.length===0?(o(),d("div",Z,y(e.$t("search.noProducts")),1)):w("",!0)])):(o(),d("div",ee,[(o(),d(b,null,k(20,p=>l(f,{key:p,class:"product-card card",animated:""})),64))])),(g=e.productsPagination)!=null&&g.next_cursor?(o(),F(v,{key:2,pending:s.productsPending,onClick:t[0]||(t[0]=p=>a.loadProducts())},{default:B(()=>[C(y(e.$t("general.showMore")),1)]),_:1},8,["pending"])):w("",!0)])])],64)}const he=x(W,[["render",te],["__scopeId","data-v-89cfe283"]]);export{he as default};
