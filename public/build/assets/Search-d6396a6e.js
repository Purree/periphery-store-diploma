import{a as R}from"./allProducts-3f9cc18a.js";import{_ as x,k as V,B as S,g as N,l as E,m as A,o as n,a as u,d as a,e as r,w as y,p as C,t as B,r as o,q as U,F as b,b as k,f as w,c as F}from"./app-fd2cb743.js";import{s as c}from"./SearchKeywordsEnum-1c50111d.js";import{b as O}from"./products-71363a85.js";import{P as q}from"./ProductCategoriesSelect-f6321c75.js";import{P as L}from"./ProductCard-aaeb5caf.js";import"./categories-79d0989a.js";import"./ProductPrice-d18bf965.js";import"./price-38bf80ae.js";import"./ProductOpenLink-2847e1ad.js";import"./StyledRouterLink-62120ab1.js";import"./ItemImage-276b9ddc.js";const T={name:"FiltersBlock",components:{ProductCategoriesSelect:q,FullWidthButton:V,BasedText:S},emits:["updateFilters"],computed:{minPrice:{get(){return this.priceBetween[0]},set(e){this.priceBetween[+(e>=this.maxPrice)]=+e}},maxPrice:{get(){return this.priceBetween[1]},set(e){this.priceBetween[1]=+e}}},data(){return{hasReviews:!1,priceBetween:[],categoriesOptions:[],selectedCategories:[],sellers:[],sellersOptions:[],selectedSellers:[],sellersPending:!0,maxAvailablePrice:1e6}},props:{productsLoadingPending:{required:!0,type:Boolean}},methods:{async loadSellers(){try{this.sellers=(await N(O)).data,this.sellersOptions=this.sellers.map(e=>({value:e.id,label:e.name})),this.sellersPending=!1}catch(e){E(A(e)),console.error(e)}},saveFilters(){const e={[c.hasReviews]:this.hasReviews||null,[c.sellers]:this.selectedSellers.join(",")||null,[c.categories]:this.selectedCategories.join(",")||null,[c.priceBetween]:this.getValidatedPriceBetween()};this.$emit("updateFilters",e)},getValidatedPriceBetween(){const[e,t]=[this.minPrice,this.maxPrice].sort((l,m)=>l-m);return e===0&&t===this.maxAvailablePrice?null:t===this.maxAvailablePrice?[e,Number.MAX_SAFE_INTEGER]:[e,t]},getFiltersFromQuery(e){return(e||"").split(",")}},mounted(){this.priceBetween=[0,this.maxAvailablePrice],this.loadSellers();const e=this.$route.query,t=e[c.priceBetween];this.hasReviews=!!e[c.hasReviews],this.selectedSellers=this.getFiltersFromQuery(e[c.sellers]).map(l=>parseInt(l)).filter(l=>l&&!isNaN(l)),this.selectedCategories=this.getFiltersFromQuery(e[c.categories]),this.priceBetween=(t||[0,this.maxAvailablePrice]).map(Number)}},I={class:"filter-block"},j={class:"filter-block"},Q={class:"slider-inputs"},D={class:"filter-block"},G={class:"filter-block"};function M(e,t,l,m,s,d){const h=o("based-text"),f=o("el-checkbox"),_=o("el-input"),P=o("el-slider"),v=o("el-select-v2"),g=o("product-categories-select"),p=o("full-width-button");return n(),u("div",null,[a("div",I,[r(f,{modelValue:s.hasReviews,"onUpdate:modelValue":t[0]||(t[0]=i=>s.hasReviews=i)},{default:y(()=>[r(h,{title:e.$t("search.filters.hasReviews")},null,8,["title"])]),_:1},8,["modelValue"])]),a("div",j,[r(h,{title:e.$t("search.filters.priceBetween")},null,8,["title"]),a("div",Q,[r(_,{modelValue:d.minPrice,"onUpdate:modelValue":t[1]||(t[1]=i=>d.minPrice=i)},null,8,["modelValue"]),r(_,{modelValue:d.maxPrice,"onUpdate:modelValue":t[2]||(t[2]=i=>d.maxPrice=i)},null,8,["modelValue"])]),r(P,{modelValue:s.priceBetween,"onUpdate:modelValue":t[3]||(t[3]=i=>s.priceBetween=i),range:"",max:s.maxAvailablePrice},null,8,["modelValue","max"])]),a("div",D,[r(h,{title:e.$t("search.filters.sellers")+":"},null,8,["title"]),r(v,{class:"filter-select",modelValue:s.selectedSellers,"onUpdate:modelValue":t[4]||(t[4]=i=>s.selectedSellers=i),disabled:s.sellersPending,filterable:"",options:s.sellersOptions,placeholder:e.$t("search.filters.sellers"),multiple:""},null,8,["modelValue","disabled","options","placeholder"])]),a("div",G,[r(h,{title:e.$t("search.filters.categories")+":"},null,8,["title"]),r(g,{"selected-categories":s.selectedCategories,"onUpdate:selectedCategories":t[5]||(t[5]=i=>s.selectedCategories=i)},null,8,["selected-categories"])]),r(p,{pending:l.productsLoadingPending,onClick:t[6]||(t[6]=i=>d.saveFilters())},{default:y(()=>[C(B(e.$t("search.filters.apply")),1)]),_:1},8,["pending"])])}const $=x(T,[["render",M],["__scopeId","data-v-cf0399cd"]]);const K={name:"Search",components:{ProductCard:L,FullWidthButton:V,FiltersBlock:$,BasedText:S},mixins:[R,U],data(){return{products:[],productsPending:!1,searchBy:""}},methods:{reloadProducts(){this.products=[],this.productsPagination=[],this.loadProducts()},loadProducts(){const e=this.$route.query;this.searchBy=e[c.searchBy],this.usePending(this.pushProductsToArray,"productsPending",this.productsPagination.next_cursor,e)},updateFilters(e){const t={[c.searchBy]:this.searchBy,...e};this.$router.push({name:"Search",query:this.deleteNullableFilters(t)})},deleteNullableFilters(e){const t={};return Object.keys(e).forEach(l=>{const m=e[l];m&&(t[l]=m)}),Object.assign(t)}},mounted(){this.reloadProducts()},watch:{$route(){this.reloadProducts()}}},W={class:"search-by-title-container"},X={class:"search-container"},z={class:"search-filters-container"},H={class:"search-filters-block card"},J={key:0},Y={key:0},Z={key:1,class:"empty-products-error card"},ee={key:1};function te(e,t,l,m,s,d){var g;const h=o("based-text"),f=o("filters-block"),_=o("product-card"),P=o("el-skeleton"),v=o("full-width-button");return n(),u(b,null,[a("div",W,[r(h,{class:"search-by-title",title:s.searchBy},null,8,["title"])]),a("div",X,[a("div",z,[a("div",H,[r(f,{"products-loading-pending":s.productsPending,onUpdateFilters:d.updateFilters},null,8,["products-loading-pending","onUpdateFilters"])])]),a("div",null,[!s.productsPending||s.products.length>0?(n(),u("div",J,[s.products.length>0?(n(),u("div",Y,[(n(!0),u(b,null,k(s.products,p=>(n(),F(_,{product:p,key:p.slug,"is-show-add-to-cart-button":!0},null,8,["product"]))),128))])):w("",!0),!s.productsPending&&s.products.length===0?(n(),u("div",Z,B(e.$t("search.noProducts")),1)):w("",!0)])):(n(),u("div",ee,[(n(),u(b,null,k(20,p=>r(P,{key:p,class:"product-card card",animated:""})),64))])),(g=e.productsPagination)!=null&&g.next_cursor?(n(),F(v,{key:2,pending:s.productsPending,onClick:t[0]||(t[0]=p=>d.loadProducts())},{default:y(()=>[C(B(e.$t("general.showMore")),1)]),_:1},8,["pending"])):w("",!0)])])],64)}const he=x(K,[["render",te],["__scopeId","data-v-89cfe283"]]);export{he as default};
