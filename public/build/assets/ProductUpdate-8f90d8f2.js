import{P as T}from"./ProductUpdateForm-dd686bb2.js";import{_ as f,q as y,S as v,k as w,g as m,m as h,o as i,a as l,e as n,w as P,p as I,t as U,r as o,i as b,d as g,F as S,b as x,c as D,f as A,u as R,v as L}from"./app-064bcfd2.js";import{f as B,g as q,h as $,i as F,j as O}from"./products-29cfa6df.js";import{P as H}from"./ProductCategoriesSelect-d2912212.js";import{I as G}from"./ItemImage-7fe01f1b.js";import"./ProductDeleteButton-1b124457.js";import"./categories-917d415f.js";const N={name:"ProductCategoriesUpdateCard",mixins:[y],emits:["updateCategories"],components:{ErrorsAlert:v,FullWidthButton:w,ProductCategoriesSelect:H},data(){return{updateCategoriesPending:!1,selectedCategories:[],errors:[]}},props:{categories:{required:!0,type:Array},externalPending:{required:!1,type:Boolean,default:!1},productSlug:{required:!0,type:String}},methods:{async updateCategories(){this.errors={};try{await m(B,{slug:this.productSlug},{categories:this.selectedCategories}),this.$emit("updateCategories")}catch(e){this.errors=h(e)}}},computed:{pending(){return this.externalPending||this.updateCategoriesPending}},watch:{categories(){this.selectedCategories=this.categories.map(e=>e.slug)}}};function V(e,t,_,C,r,s){const d=o("errors-alert"),c=o("product-categories-select"),p=o("full-width-button");return i(),l("div",null,[n(d,{errors:r.errors},null,8,["errors"]),n(c,{"selected-categories":r.selectedCategories,"onUpdate:selectedCategories":t[0]||(t[0]=a=>r.selectedCategories=a),pending:s.pending,class:"product-categories-select"},null,8,["selected-categories","pending"]),n(p,{class:"categories-save-button",pending:s.pending,onClick:t[1]||(t[1]=a=>e.usePending(s.updateCategories,"updateCategoriesPending"))},{default:P(()=>[I(U(e.$t("general.save")),1)]),_:1},8,["pending"])])}const j=f(N,[["render",V],["__scopeId","data-v-35a8ec82"]]);const M={name:"ProductImagesUpdateCard",emits:["imagesUpdate"],components:{FontAwesomeIcon:b,ErrorsAlert:v,FullWidthButton:w,ItemImage:G},mixins:[y],data(){return{newImages:[],errors:[],productUploadPending:!1,productImageDeletePending:!1}},props:{productSlug:{required:!0,type:String},externalPending:{required:!1,type:Boolean,default:!1},currentImages:{required:!0,type:Array}},methods:{async uploadImages(){if(this.errors=[],this.newImages.length===0){this.errors=[[this.$t("product.updateProduct.images.tooFewImages")]];return}const e=new FormData;this.newImages.forEach(t=>{e.append("images[]",t.raw)});try{await m(q,{slug:this.productSlug},e),this.$emit("imagesUpdate"),this.newImages=[]}catch(t){this.errors=h(t)}},async deleteImage(e){this.errors=[];try{await m($,{slug:this.productSlug,imageId:e}),this.$emit("imagesUpdate")}catch(t){this.errors=h(t)}}},computed:{maxLoadedImagesCount(){return 10-this.currentImages.length},pending(){return this.externalPending||this.productUploadPending||this.productImageDeletePending}}},W={class:"current-images-container"},z={class:"images-upload-form"};function J(e,t,_,C,r,s){const d=o("item-image"),c=o("font-awesome-icon"),p=o("el-button"),a=o("el-upload"),k=o("errors-alert"),E=o("full-width-button");return i(),l("div",null,[g("div",W,[(i(!0),l(S,null,x(_.currentImages,u=>(i(),l("div",{key:u.id,class:"current-image-block"},[n(d,{"image-url":u.link},null,8,["image-url"]),n(p,{disabled:s.pending,loading:s.pending,type:"danger",onClick:oe=>e.usePending(s.deleteImage,"productImageDeletePending",u.id),class:"delete-image-button"},{default:P(()=>[n(c,{type:"danger",icon:"trash"},{default:P(()=>[I(U(e.$t("profile.avatar.buttons.delete")),1)]),_:1})]),_:2},1032,["disabled","loading","onClick"])]))),128))]),g("div",z,[s.maxLoadedImagesCount?(i(),D(a,{key:0,class:"image-upload-container",drag:!0,multiple:!0,limit:s.maxLoadedImagesCount,"file-list":r.newImages,"onUpdate:fileList":t[0]||(t[0]=u=>r.newImages=u),"list-type":"picture-card",accept:"image/png, image/gif, image/jpeg","auto-upload":!1},null,8,["limit","file-list"])):A("",!0)]),n(k,{errors:r.errors},null,8,["errors"]),n(E,{pending:s.pending,onClick:t[1]||(t[1]=u=>e.usePending(s.uploadImages,"productUploadPending"))},{default:P(()=>[I(U(e.$t("general.save")),1)]),_:1},8,["pending"])])}const K=f(M,[["render",J],["__scopeId","data-v-b183de10"]]);const Q={name:"ProductUpdateCard",components:{ProductImagesUpdateCard:K,ProductCategoriesUpdateCard:j,ProductUpdateForm:T},data(){return{product:{},errors:{},pending:!1,productSlug:""}},mixins:[y,R],methods:{async onProductUpdateButtonClick(e){this.errors={},e.append("_method","PUT");try{this.product=(await m(F,{slug:this.productSlug},e)).data}catch(t){this.errors=h(t)}},async onProductDeleteButtonClick(){await this.redirectToHome()},async loadProduct(){await this.useErrorsCatch(async()=>{const e=(await m(O,{slug:this.productSlug})).data;e.seller.id!==this.user.id&&await this.redirectToHome(),this.product=e},async()=>{await this.redirectToHome()})},async redirectToHome(){await this.$router.push({name:"Home"})}},computed:{...L("auth",["user"])},mounted(){this.productSlug=this.$route.params.slug,this.usePending(this.loadProduct)}},X={class:"card"},Y={class:"card"},Z={class:"card"};function ee(e,t,_,C,r,s){const d=o("product-update-form"),c=o("product-categories-update-card"),p=o("product-images-update-card");return i(),l(S,null,[g("div",X,[n(d,{"request-errors":r.errors,"product-to-update":r.product,pending:r.pending,onDeleteProduct:t[0]||(t[0]=a=>e.usePending(s.onProductDeleteButtonClick)),onUpdateProduct:t[1]||(t[1]=a=>e.usePending(s.onProductUpdateButtonClick,"pending",a))},null,8,["request-errors","product-to-update","pending"])]),g("div",Y,[n(c,{onUpdateCategories:t[2]||(t[2]=a=>e.usePending(s.loadProduct)),"product-slug":r.productSlug,categories:r.product.categories||[],"external-pending":r.pending},null,8,["product-slug","categories","external-pending"])]),g("div",Z,[n(p,{onImagesUpdate:t[3]||(t[3]=a=>e.usePending(s.loadProduct)),"product-slug":r.productSlug,"external-pending":r.pending,"current-images":r.product.images||[]},null,8,["product-slug","external-pending","current-images"])])],64)}const te=f(Q,[["render",ee],["__scopeId","data-v-947634d1"]]),re={name:"ProductUpdate",components:{ProductUpdateCard:te}};function se(e,t,_,C,r,s){const d=o("product-update-card");return i(),D(d)}const le=f(re,[["render",se]]);export{le as default};
