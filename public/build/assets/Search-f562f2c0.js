import{a as R}from"./allProducts-8761eece.js";import{_ as x,k as V,B as S,g as N,l as E,m as A,p as c,o as n,a as u,d as a,e as r,w as y,q as C,t as B,r as o,v as U,F as b,b as k,f as w,c as F}from"./app-20c5f567.js";import{b as O}from"./products-76e00124.js";import{P as q}from"./ProductCategoriesSelect-12c0af57.js";import{P as L}from"./ProductCard-987b3fa6.js";import"./categories-c4f0b5ee.js";import"./ProductPrice-ed22b151.js";import"./price-38bf80ae.js";import"./ProductOpenLink-46bf5b4d.js";import"./StyledRouterLink-521a588a.js";import"./ItemImage-d2e4cc83.js";const T={name:"FiltersBlock",components:{ProductCategoriesSelect:q,FullWidthButton:V,BasedText:S},emits:["updateFilters"],computed:{minPrice:{get(){return this.priceBetween[0]},set(e){this.priceBetween[+(e>=this.maxPrice)]=+e}},maxPrice:{get(){return this.priceBetween[1]},set(e){this.priceBetween[1]=+e}}},data(){return{hasReviews:!1,priceBetween:[],categoriesOptions:[],selectedCategories:[],sellers:[],sellersOptions:[],selectedSellers:[],sellersPending:!0,maxAvailablePrice:1e6}},props:{productsLoadingPending:{required:!0,type:Boolean}},methods:{async loadSellers(){try{this.sellers=(await N(O)).data,this.sellersOptions=this.sellers.map(e=>({value:e.id,label:e.name})),this.sellersPending=!1}catch(e){E(A(e)),console.error(e)}},saveFilters(){const e={[c.hasReviews]:this.hasReviews||null,[c.sellers]:this.selectedSellers.join(",")||null,[c.categories]:this.selectedCategories.join(",")||null,[c.priceBetween]:this.getValidatedPriceBetween()};this.$emit("updateFilters",e)},getValidatedPriceBetween(){const[e,t]=[this.minPrice,this.maxPrice].sort((l,h)=>l-h);return e===0&&t===this.maxAvailablePrice?null:t===this.maxAvailablePrice?[e,Number.MAX_SAFE_INTEGER]:[e,t]},getFiltersFromQuery(e){return e&&typeof e=="string"?e.split(","):e}},mounted(){this.priceBetween=[0,this.maxAvailablePrice],this.loadSellers();const e=this.$route.query,t=e[c.priceBetween];this.hasReviews=!!e[c.hasReviews],this.selectedSellers=this.getFiltersFromQuery(e[c.sellers]).map(l=>parseInt(l)).filter(l=>l&&!isNaN(l)),this.selectedCategories=this.getFiltersFromQuery(e[c.categories]),this.priceBetween=(t||[0,this.maxAvailablePrice]).map(Number)}},j={class:"filter-block"},Q={class:"filter-block"},D={class:"slider-inputs"},G={class:"filter-block"},M={class:"filter-block"};function $(e,t,l,h,s,d){const m=o("based-text"),P=o("el-checkbox"),_=o("el-input"),f=o("el-slider"),v=o("el-select-v2"),g=o("product-categories-select"),p=o("full-width-button");return n(),u("div",null,[a("div",j,[r(P,{modelValue:s.hasReviews,"onUpdate:modelValue":t[0]||(t[0]=i=>s.hasReviews=i)},{default:y(()=>[r(m,{title:e.$t("search.filters.hasReviews")},null,8,["title"])]),_:1},8,["modelValue"])]),a("div",Q,[r(m,{title:e.$t("search.filters.priceBetween")},null,8,["title"]),a("div",D,[r(_,{modelValue:d.minPrice,"onUpdate:modelValue":t[1]||(t[1]=i=>d.minPrice=i)},null,8,["modelValue"]),r(_,{modelValue:d.maxPrice,"onUpdate:modelValue":t[2]||(t[2]=i=>d.maxPrice=i)},null,8,["modelValue"])]),r(f,{modelValue:s.priceBetween,"onUpdate:modelValue":t[3]||(t[3]=i=>s.priceBetween=i),range:"",max:s.maxAvailablePrice},null,8,["modelValue","max"])]),a("div",G,[r(m,{title:e.$t("search.filters.sellers")+":"},null,8,["title"]),r(v,{class:"filter-select",modelValue:s.selectedSellers,"onUpdate:modelValue":t[4]||(t[4]=i=>s.selectedSellers=i),disabled:s.sellersPending,filterable:"",options:s.sellersOptions,placeholder:e.$t("search.filters.sellers"),multiple:""},null,8,["modelValue","disabled","options","placeholder"])]),a("div",M,[r(m,{title:e.$t("search.filters.categories")+":"},null,8,["title"]),r(g,{"selected-categories":s.selectedCategories,"onUpdate:selectedCategories":t[5]||(t[5]=i=>s.selectedCategories=i)},null,8,["selected-categories"])]),r(p,{pending:l.productsLoadingPending,onClick:t[6]||(t[6]=i=>d.saveFilters())},{default:y(()=>[C(B(e.$t("search.filters.apply")),1)]),_:1},8,["pending"])])}const K=x(T,[["render",$],["__scopeId","data-v-22a056a4"]]);const W={name:"Search",components:{ProductCard:L,FullWidthButton:V,FiltersBlock:K,BasedText:S},mixins:[R,U],data(){return{products:[],productsPending:!1,searchBy:""}},methods:{reloadProducts(){this.products=[],this.productsPagination=[],this.loadProducts()},loadProducts(){const e=this.$route.query;this.searchBy=e[c.searchBy],this.usePending(this.pushProductsToArray,"productsPending",this.productsPagination.next_cursor,e)},updateFilters(e){const t={[c.searchBy]:this.searchBy,...e};this.$router.push({name:"Search",query:this.deleteNullableFilters(t)})},deleteNullableFilters(e){const t={};return Object.keys(e).forEach(l=>{const h=e[l];h&&(t[l]=h)}),Object.assign(t)}},mounted(){this.reloadProducts()},watch:{$route(){this.reloadProducts()}}},X={class:"search-by-title-container"},z={class:"search-container"},H={class:"search-filters-container"},J={class:"search-filters-block card"},Y={key:0},Z={key:0},I={key:1,class:"empty-products-error card"},ee={key:1};function te(e,t,l,h,s,d){var g;const m=o("based-text"),P=o("filters-block"),_=o("product-card"),f=o("el-skeleton"),v=o("full-width-button");return n(),u(b,null,[a("div",X,[r(m,{class:"search-by-title",title:s.searchBy},null,8,["title"])]),a("div",z,[a("div",H,[a("div",J,[r(P,{"products-loading-pending":s.productsPending,onUpdateFilters:d.updateFilters},null,8,["products-loading-pending","onUpdateFilters"])])]),a("div",null,[!s.productsPending||s.products.length>0?(n(),u("div",Y,[s.products.length>0?(n(),u("div",Z,[(n(!0),u(b,null,k(s.products,p=>(n(),F(_,{product:p,key:p.slug,"is-show-add-to-cart-button":!0},null,8,["product"]))),128))])):w("",!0),!s.productsPending&&s.products.length===0?(n(),u("div",I,B(e.$t("search.noProducts")),1)):w("",!0)])):(n(),u("div",ee,[(n(),u(b,null,k(20,p=>r(f,{key:p,class:"product-card card",animated:""})),64))])),(g=e.productsPagination)!=null&&g.next_cursor?(n(),F(v,{key:2,pending:s.productsPending,onClick:t[0]||(t[0]=p=>d.loadProducts())},{default:y(()=>[C(B(e.$t("general.showMore")),1)]),_:1},8,["pending"])):w("",!0)])])],64)}const he=x(W,[["render",te],["__scopeId","data-v-89cfe283"]]);export{he as default};
